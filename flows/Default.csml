// Ceci est un commentaire, ils commencent tous par //
// Le CSML ignore les commentaires, ils sont utiles pour les dÃ©veloppeurs :3

// Un chatbot commence toujours par l'Ã©tape "start" ci-dessous
start:
  // On va saluer l'utilisateur avec la commande `say`
  say "Salut!"
  say "Je suis Deezobot, le bot qui te conseille les musiques et playlists du moment ğŸ¤™"
  // On peut poser une question Ã  l'utilisateur et donner des choix de boutons
  say Question("Tu es prÃªt.e ?",
    buttons=[
      // Vous remarquerez qu'on utilise le mot clÃ© "as", il permet au csml de se souvenir de ce bouton
      // pour s'en servir plus tard (dans le if)
      Button("Oui let's gooo! ğŸ”¥") as btnOui,
      Button("Pas tout Ã  fait ğŸ˜•") as btnNon
    ])
  // "hold" indique au chatbot qu'il doit attendre une rÃ©ponse de l'utilisateur (une phrase ou un click)
	hold
  // La rÃ©ponse de l'utilisateur va arriver dans la variable `event`
  // Dans le cas prÃ©sent on va voir ce que contient cette variable en demandant au csml si event "match" le bouton Oui
  if (event match btnOui) {
    say "Super allons-y!"
  } else {
    say "Pas de soucis, je me tiens Ã  ta disposition!"
    goto end
  }
  
// ############################################################
// Ã€ toi de jouer maintenant, il va falloir remplir les trous !
// ############################################################
// Exercice 0 : Efface la ligne ci-dessous pour commencer le workshop
/*
  remember mood = false
  remember hits = false

  say "Trouvons les musiques faites pour toi!"
  say "J'ai juste besoin de te poser quelques questions ğŸ§."
	goto categories

categories:
  // 1 - Il manque un mot clÃ© pour poser la question
	???? Question("Tu es plutÃ´t... ?",
	buttons=[
    Button("Fan des derniers hits ğŸ”¥") as btn_hits,
    Button("De la musique au feeling ğŸ˜Œ") as btn_feelings
  ])
  // 2 - Indique au chatbot d'attendre la rÃ©ponse de l'utilisateur ici
	????
  // 3 - Voici une condition, il manque un mot clÃ© plusieurs fois
  if (event match btn_hits) {
    ???? hits
  }
  if (event match btn_feelings) {
    ???? moods
  } else {
    say "Clique sur un bouton :)"
    ???? categories
  }
  goto moods


// 4 - Il faut nommer l'Ã©tape ci-dessous
????:
  // 5 - Tu dois ajouter le mot clÃ© manquant pour que Ã§a marche
  say ????("Comment te sens-tu en ce moment ?",
	buttons=[
	  Button("En super forme ğŸ’ª", payload="forme"),
    Button("Pas le moral ğŸ˜©", payload="moral"),
	  Button("Câ€™est lâ€™Ã©tÃ© ğŸ", payload="ete"),
	  Button("Letâ€™s dance ğŸ’ƒğŸ•º", payload="dance"),
	  Button("Un peu anxieux.se ğŸ˜–", payload="anx"),
  ])
  hold
  // 6 - Tu dois te souvenir de la saisie de l'utilisateur en la mettant
  // dans la variable `mood`
  ???? mood = event
  goto results
  
hits:
  // 7 - Il manque BEAUCOUP de chose ci-dessous
  say ????("Comment souhaites-tu que je classe les hits du moment ?",
	????=[
		????("Album"),
		????("Artiste"),
		????("Morceau"),
		????("Playlist")
  ])
  hold
  ???? hits = ????
  // 8 - Indique au chatbot qu'il doit se rendre Ã  l'Ã©tape results`
  ???? results

// 9 - Il manque le nom de l'Ã©tape
????:
  // BRAVO, tu as fini!
  if (!mood) do mood = false
  if (!hits) do hits = false
	say "Roulement de tambours ğŸ¥"
	say Typing(3000)
  remember res = App("Deezer", mood=mood, hits=hits)

  if (res.length() == 0) {
    say "Je n'ai pas trouvÃ© de playlist, dÃ©solÃ© ğŸ˜”"
    goto start
  }
  if (!res.id) goto resulthits
  else goto resultsplaylist

resultsplaylist:
  say "Voici la playlist qui te correspond :"
  say "**{{res.title}}**"
  say "crÃ©e par *res.creator.name*, *{{res.fans}}* fans"
  say Typing(3000)
  say Image("{{res.picture_medium}}")
  say Url("{{res.link}}", hide_url=true)
  goto end

resulthits:
  do cards = []
  foreach (val, index) in res {
    if (val.title) do name = val.title
    if (val.name) do name = val.name
    if (val.picture_medium) do pic = val.picture_medium
    if (val.cover_medium) do pic = val.cover_medium
    if (val.artist.picture_medium)do pic = val.artist.picture_medium
    do newCard = Card(
      title=name,
      // subtitle="{{val.fields.price_type}}â‚¬ - {{val.fields.address_name}}",
      image_url=pic,
      buttons=[Url(val.link, text=name)]
    )
    if (index < 6) do cards.push(newCard)
  }
  say Carousel(
    cards = cards
  )
  goto end
